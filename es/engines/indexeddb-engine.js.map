{"version":3,"file":"indexeddb-engine.js","sources":["../../src/engines/indexeddb-engine.ts"],"sourcesContent":[null],"names":["IndexedDBEngine","BaseStorageEngine","constructor","config","Object","defineProperty","dbName","version","storeName","create","engine","initialize","available","window","indexedDB","db","Promise","resolve","reject","request","open","onerror","Error","error","onsuccess","result","updateUsedSize","then","catch","console","onupgradeneeded","event","target","objectStoreNames","contains","store","createObjectStore","keyPath","createIndex","unique","getTransaction","mode","transaction","getStore","objectStore","executeRequest","setItem","key","value","ttl","now","Date","item","createdAt","expiresAt","undefined","put","getItem","get","removeItem","warn","delete","clear","_usedSize","keys","getAllKeys","map","String","length","count","cleanup","index","range","IDBKeyRange","upperBound","cursor","openCursor","deletePromises","push","primaryKey","continue","all","getDatabaseSize","items","getAll","totalSize","itemSize","calculateSize","JSON","stringify"],"mappings":"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"}