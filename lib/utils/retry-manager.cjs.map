{"version":3,"file":"retry-manager.cjs","sources":["../../src/utils/retry-manager.ts"],"sourcesContent":[null],"names":["RetryManager","constructor","Object","defineProperty","value","maxAttempts","initialDelay","maxDelay","factor","strategy","jitter","shouldRetry","onRetry","timeout","retry","fn","options","opts","defaultOptions","startTime","Date","now","lastError","attempt","result","withTimeout","success","data","attempts","totalDuration","error","Error","String","delay","calculateDelay","sleep","Math","min","fibonacci","random","n","a","b","i","promise","Promise","race","_","reject","setTimeout","ms","resolve","CircuitBreaker","failureThreshold","successThreshold","resetTimeout","windowSize","execute","state","shouldAttemptReset","onSuccess","onFailure","recordRequest","successCount","reset","lastFailureTime","trip","failureCount","getFailureRate","requests","push","length","shift","failures","filter","r","undefined","getState","getStats","failureRate","FallbackHandler","addFallback","fallback","fallbacks","primary","errors","onFallback","globalThis","AggregateError","withRetry","retryManager","args","withCircuitBreaker","circuitBreaker","withFallback","handler","forEach","fb"],"mappings":"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"}